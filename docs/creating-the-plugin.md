# Creating the fmsf2hms Plugin

## Helfpul References

Repo: https://github.com/legiongis/fmsf2hms

User Documentation: [https://www.notion.so/FMSF-to-HMS-QGIS-Plugin-1a413cd8aa334e9bb2180be8c6841665](https://www.notion.so/FMSF-to-HMS-QGIS-Plugin-1a413cd8aa334e9bb2180be8c6841665?pvs=21)

Helpful Guide: https://www.qgistutorials.com/en/docs/3/building_a_python_plugin.html

Especially important in this guide is the pointer to the Plugin Builder and Plugin Reloader, they (especially the latter) were indispensable during development.

PyQGIS Cookbook: https://docs.qgis.org/3.10/en/docs/pyqgis_developer_cookbook/index.html

PyQGIS 101: https://anitagraser.com/pyqgis-101-introduction-to-qgis-python-programming-for-non-programmers/

I found this material extremely helpful. It's especially nice that you can mock up certain operations in the Python console and use the exact same code in your plugin's logic.

Running Processing Tools from within the Plugin Scripts: https://anitagraser.com/pyqgis-101-introduction-to-qgis-python-programming-for-non-programmers/pyqgis-101-running-processing-tools/

This is a very important pattern to be aware of. It allows you to mock up any processing tools by running them once in QGIS with their GUIs and then copying out the input variables and then running them in pyqgis.

## Notes

- I used the Plugin Builder to make a single vector tool. Then I duplicated the pattern between the `fmsf_hms_dialogs.py` file, the `*.ui` file, and the `fmsf_hms.py` file to expand from 1 tool to 4.
    - The .ui file is referenced in the fmsf_hms_dialogs.py file which is referenced in the main fmsf_hms.py file.
    - I created a new file `fms_hms_utils.py` which has classes and methods that are called in `fmsf_hms.py`. This is where the real scripting happens.
- The `fmsf_hms.py` file generated by the Plugin Builder contains some `if self.first_start == True` checks that were used during the association of the dialog with the tool. I found this to be unnecessary and potentially the cause of some weirdness, so I removed the logic altogether.
- I handled the creation of multiple tools in `fmsf_hms.py` by
    1. Duplicating the `self.add_action()` calls in initGui. This is where you define where the tools will appear (in a toolbar, menu, etc.) The callback for each is a different `self.run_actionname()` method that is defined later in the class.
    2. There is one `self.run_actionname()` method for each tool. It's in these methods that the correct dialog is associated with the tool, and that all of the python logic for the tool itself is called.
- To design the dialog GUIs I used the Qt Designer application that comes installed with QGIS. For me, it was located at `C:\Program Files\QGIS 3.12\apps\qt5\bin\designer.exe` .
- Qt Designer doesn't really have a "find file" browser window widget. You need to use a line edit widget plus a button and then write logic into the `fmsf_hms.py` file. I followed a pattern described in the Helpful Guide linked above. This looks like another way to handle it, which I haven't tried: https://gis.stackexchange.com/a/115792/28414
- On Windows, I had trouble running `pyrcc5 -o resources.py resources.qrc` due to missing environment variables so I wrapped that command in a new .bat file I called `make_resources.py.bat`:
    
    ```
    @echo off
    call "C:\Program Files\QGIS 3.12\bin\o4w_env.bat"
    call "C:\Program Files\QGIS 3.12\bin\qt5_env.bat"
    call "C:\Program Files\QGIS 3.12\bin\py3_env.bat"
    
    @echo on
    pyrcc5 -o resources.py resources.qrc
    ```
    
- I downloaded a set of icons (png) from [www.flaticon.com](http://www.flaticon.com/). Spent way too long picking out which icon pack to get.
    - Including them in the toolbars next to the tool names is very easy, just a relative path in the main fmsf_hms.py file.
    - Including them in the Qt UIs was not so easy: you must first add them as "resources" in Qt Designer, and then you can associate them with the dialogs. **When you add resources in Qt Designer, the .ui files that get saved out have an error in them that you need to manually remove, it's very annoying. This answer explains it all:** https://gis.stackexchange.com/a/155599/28414